<html>

<head>
  <style>
    .planet-content .info {
      display: flex;
      flex-flow: row nowrap;
    }

    .planet-content .info>div {
      flex: 1 0 0;
    }

  </style>
  <script>
    getEmiliaInfo = (script, callback) => {
      const xhr = new XMLHttpRequest();
      xhr.open(`GET`, script, true);
      xhr.onreadystatechange = () => {
        if (xhr.readyState !== 4) return;
        if (xhr.status !== 200) return;
        else callback(xhr.responseText);
      };
      xhr.send();
    }

    onPlanetContentLoad = () => {
      const versionAttribute = `data-emilia-version`;
      const modifiedAttribute = `data-emilia-modified`;
      const body = document.querySelector(`body`);
      const version = body.getAttribute(versionAttribute);
      const modified = body.getAttribute(modifiedAttribute);

      const versionNode = document.querySelector(`.planet-content .version`);
      const modifiedNode = document.querySelector(`.planet-content .modified`);
      if (version && modified) {
        versionNode.textContent = version;
        modifiedNode.textContent = modified;
      } else getEmiliaInfo(`scripts/server-info.exe`, response => {
        if (!versionNode || !modifiedNode) return;

        const propertyParser = new DOMParser().parseFromString(response, `text/html`);
        versionNode.textContent = propertyParser
          .evaluate(`//h2[text()="Emilia Server Version"]/following-sibling::pre[1]`, propertyParser)
          .iterateNext()
          .textContent;
        body.setAttribute(versionAttribute, versionNode.textContent);
        modifiedNode.textContent = propertyParser
          .evaluate(`//h2[text()="Emilia-tan Last Modified Time"]/following-sibling::pre[1]`, propertyParser)
          .iterateNext()
          .textContent
          .split(` `)[0];
        body.setAttribute(modifiedAttribute, modifiedNode.textContent);
      });
    }
    onPlanetContentLoad();
  </script>
</head>

<body>
  <div class="meta">
    <div class="label">
      <span>.</span>
    </div>
    <div class="subplanets"></div>
  </div>
  <div class="planet-content">
    <p class="center">
      <span class="larger">EMILIA</span><br>
      <div class="info">
        <div class="right">
          <a class="version" href="https://github.com/gilgameshxzero/emilia">————</a>
        </div>
        <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
        <div class="left">
          <a class="modified" href="https://github.com/gilgameshxzero/emilia-tan">————</a>
        </div>
      </div>
      <br>
      <div class="center">
        HTTP & SMTP server in WinAPI C++<br>
        hosted on WINDOWS from my room<br>
        tunneled via AUTOSSH through AWS EC2<br>
        UI/UX DESIGNED & BUILT from scratch<br>
        <br>
        based on <a href="https://myanimelist.net/character/118737/Emilia">EMILIA from RE: ZERO</a><br>
      </div>
    </p>
  </div>
</body>

</html>
